<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>360Â° Bilvisning â€“ Upload</title>
    <style>
        html, body {
            overscroll-behavior: none;
            touch-action: none; /* ðŸ”’ Forhindrer scrolling og pinch-zoom af hele siden */
            background: #f2f2f2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #upload-container {
            text-align: center;
            margin-bottom: 20px;
        }

        #viewer {
            width: 600px;
            height: 400px;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            cursor: grab;
            background: #fff;
            display: none; /* skjult indtil billeder er valgt */
            position: relative;
        }

        #viewer img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            user-select: none;
            pointer-events: none;
            transform-origin: center center;
            transition: transform 0.15s ease-out;
        }

        #backBtn {
            margin-top: 20px;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #1976d2;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        #backBtn:hover {
            background: #0d47a1;
        }
    </style>
</head>
<body>

<div id="upload-container">
    <h2>Upload billeder til 360Â° visning</h2>
    <input type="file" id="imageInput" accept="image/*" multiple>
    <p>VÃ¦lg fx 10â€“20 billeder taget rundt om bilen.</p>
</div>

<div id="viewer">
    <img id="car" />
</div>

<!-- ðŸ”™ Tilbage-knap -->
<button id="backBtn" onclick="window.location.href='dashboard.html'">Tilbage til Dashboard</button>

<script>
    let images = [];
    let frame = 0;
    let isDragging = false;
    let startX = 0;
    let zoom = 1;
    let initialDistance = 0;
    const viewer = document.getElementById("viewer");
    const car = document.getElementById("car");

    function updateImage() {
        car.src = images[frame];
    }

    // ðŸ“¸ NÃ¥r brugeren vÃ¦lger billeder
    document.getElementById("imageInput").addEventListener("change", (event) => {
        const files = Array.from(event.target.files);
        if (files.length === 0) return alert("VÃ¦lg mindst Ã©t billede.");

        files.sort((a, b) => a.name.localeCompare(b.name));
        images = files.map(file => URL.createObjectURL(file));

        frame = 0;
        updateImage();
        viewer.style.display = "block";
    });

    // ðŸ–±ï¸ Roter med mus
    viewer.addEventListener("mousedown", e => {
        isDragging = true;
        startX = e.clientX;
        viewer.style.cursor = "grabbing";
    });

    viewer.addEventListener("mouseup", () => {
        isDragging = false;
        viewer.style.cursor = "grab";
    });

    viewer.addEventListener("mousemove", e => {
        if (!isDragging || images.length === 0) return;
        const delta = e.clientX - startX;
        if (Math.abs(delta) > 10) {
            frame += delta > 0 ? -1 : 1;
            if (frame < 0) frame = images.length - 1;
            if (frame >= images.length) frame = 0;
            updateImage();
            startX = e.clientX;
        }
    });

    // ðŸ” Zoom med musens scrollhjul
    viewer.addEventListener("wheel", e => {
        e.preventDefault();
        zoom += e.deltaY < 0 ? 0.1 : -0.1;
        zoom = Math.min(Math.max(zoom, 1), 3);
        car.style.transform = `scale(${zoom})`;
    });

    // ðŸ” Dobbeltklik nulstiller zoom
    viewer.addEventListener("dblclick", () => {
        zoom = 1;
        car.style.transform = "scale(1)";
    });

    // ðŸ“± Touchrotation + pinchzoom
    let lastTouchX = 0;

    viewer.addEventListener('touchstart', e => {
        if (e.touches.length === 1) {
            lastTouchX = e.touches[0].clientX;
        }
        if (e.touches.length === 2) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            initialDistance = Math.hypot(dx, dy);
        }
        e.preventDefault(); // ðŸš« Stop siden i at scrolle
    });

    viewer.addEventListener('touchmove', e => {
        if (e.touches.length === 1) {
            const touchX = e.touches[0].clientX;
            const delta = touchX - lastTouchX;

            if (Math.abs(delta) > 10 && images.length > 0) {
                frame += delta > 0 ? -1 : 1;
                if (frame < 0) frame = images.length - 1;
                if (frame >= images.length) frame = 0;
                updateImage();
                lastTouchX = touchX;
            }
            e.preventDefault(); // ðŸš« Forhindrer scroll
        }

        // ðŸ”Ž Pinch zoom
        if (e.touches.length === 2) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            const distance = Math.hypot(dx, dy);
            const scaleChange = distance / initialDistance;
            zoom *= scaleChange;
            zoom = Math.min(Math.max(zoom, 1), 3);
            car.style.transform = `scale(${zoom})`;
            initialDistance = distance;
            e.preventDefault();
        }
    });
</script>

</body>
</html>